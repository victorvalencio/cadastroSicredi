<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro e Relatório de Compras</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .form-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #f9f9f9;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"], input[type="number"], input[type="date"], input[type="datetime-local"] {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }

        button {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #218838;
        }

        .result {
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid black;
        }

        th, td {
            padding: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
<div class="form-container">
    <h2>Cadastro de Compras</h2>
    <form id="compraForm">
        <div class="form-group">
            <label for="produtoId">ID do Produto:</label>
            <input type="text" id="produtoId" required>
        </div>
        <div class="form-group">
            <label for="nomeProduto">Nome do Produto:</label>
            <input type="text" id="nomeProduto" required>
        </div>
        <div class="form-group">
            <label for="quantidade">Quantidade:</label>
            <input type="number" id="quantidade" required>
        </div>
        <div class="form-group">
            <label for="cpfComprador">CPF do Comprador (com máscara):</label>
            <input type="text" id="cpfComprador" required placeholder="123.456.789-00">
        </div>
        <div class="form-group">
            <label for="valorUnitario">Valor Unitário:</label>
            <input type="number" id="valorUnitario" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="dataCompra">Data da Compra:</label>
            <input type="datetime-local" id="dataCompra" required>
        </div>
        <button type="submit">Cadastrar Compra</button>
    </form>

    <div class="result" id="result"></div>

    <hr>

    <h2>Gerar Relatório de Compras</h2>
    <form id="relatorioForm">
        <div class="form-group">
            <label for="dataInicio">Data Início:</label>
            <input type="date" id="dataInicio" required>
        </div>
        <div class="form-group">
            <label for="dataFim">Data Fim:</label>
            <input type="date" id="dataFim" required>
        </div>
        <button type="submit">Gerar Relatório</button>
    </form>

    <div class="result" id="relatorioResult"></div>

    <hr>

    <h2>Consultar Compras Realizadas</h2>
    <form id="consultaForm">
        <div class="form-group">
            <label for="cpfConsulta">CPF do Comprador:</label>
            <input type="text" id="cpfConsulta" placeholder="123.456.789-00">
        </div>
        <div class="form-group">
            <label for="nomeProdutoConsulta">Nome do Produto:</label>
            <input type="text" id="nomeProdutoConsulta" placeholder="Notebook">
        </div>
        <button type="submit">Consultar Compras</button>
    </form>

    <div class="result" id="consultaResult"></div>
</div>

<script>
    // Cadastro de Compras
    const form = document.getElementById('compraForm');
    const resultDiv = document.getElementById('result');

    form.addEventListener('submit', function (event) {
        event.preventDefault();

        const compraData = {
            produtoId: document.getElementById('produtoId').value,
            nomeProduto: document.getElementById('nomeProduto').value,
            quantidade: document.getElementById('quantidade').value,
            cpfComprador: document.getElementById('cpfComprador').value,
            valorUnitario: document.getElementById('valorUnitario').value,
            dataCompra: document.getElementById('dataCompra').value
        };

        fetch('http://localhost:8080/compras', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(compraData)
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(errorData => {
                    throw new Error(errorData.message || 'Erro desconhecido');
                });
            }
            return response.json();
        })
        .then(data => {
            resultDiv.innerHTML = `<p>Compra cadastrada com sucesso! ID da compra: ${data.id}</p>`;
        })
        .catch(error => {
            console.error('Erro ao cadastrar compra:', error);
            resultDiv.innerHTML = `<p style="color: red;">Erro: ${error.message}</p>`;
        });
    });

    // Relatório de Compras
    const relatorioForm = document.getElementById('relatorioForm');
    const relatorioResultDiv = document.getElementById('relatorioResult');

    relatorioForm.addEventListener('submit', function(event) {
        event.preventDefault();

        const dataInicio = document.getElementById('dataInicio').value;
        const dataFim = document.getElementById('dataFim').value;

        fetch(`http://localhost:8080/compras/relatorio?dataInicio=${dataInicio}&dataFim=${dataFim}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(errorData => {
                    throw new Error(errorData.message || 'Erro desconhecido ao gerar relatório');
                });
            }
            return response.json();
        })
        .then(data => {
            if (data.length === 0) {
                relatorioResultDiv.innerHTML = `<p>Nenhuma compra encontrada para o período.</p>`;
                return;
            }

            let resultHtml = `<h3>Relatório de Compras</h3>`;
            resultHtml += `<table><thead><tr><th>Nome do Produto</th><th>Valor Unitário</th><th>Quantidade Comprada</th><th>Total Vendido</th></tr></thead><tbody>`;

            data.forEach(item => {
                resultHtml += `
                    <tr>
                        <td>${item.nomeProduto}</td>
                        <td>${item.valorUnitario.toFixed(2)}</td>
                        <td>${item.quantidadeCompras}</td>
                        <td>${item.totalVendido}</td>
                    </tr>
                `;
            });

            resultHtml += `</tbody></table>`;
            relatorioResultDiv.innerHTML = resultHtml;
        })
        .catch(error => {
            console.error('Erro ao gerar relatório:', error);
            relatorioResultDiv.innerHTML = `<p style="color: red;">Erro: ${error.message}</p>`;
        });
    });

    // Consulta de Compras
    const consultaForm = document.getElementById('consultaForm');
    const consultaResultDiv = document.getElementById('consultaResult');

    consultaForm.addEventListener('submit', function(event) {
        event.preventDefault();

        const cpf = document.getElementById('cpfConsulta').value;
        const nomeProduto = document.getElementById('nomeProdutoConsulta').value;

        let queryParams = '';
        if (cpf) {
            queryParams += `cpf=${cpf}`;
        }
        if (nomeProduto) {
            if (queryParams.length > 0) queryParams += '&';
            queryParams += `nomeProduto=${nomeProduto}`;
        }

        fetch(`http://localhost:8080/compras?${queryParams}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(errorData => {
                    throw new Error(errorData.message || 'Erro desconhecido ao consultar compras');
                });
            }
            return response.json();
        })
        .then(data => {
            if (data.length === 0) {
                consultaResultDiv.innerHTML = `<p>Nenhuma compra encontrada.</p>`;
                return;
            }

            let resultHtml = `<h3>Compras Realizadas</h3>`;
            resultHtml += `<table><thead><tr><th>Nome do Produto</th><th>Quantidade</th><th>CPF do Comprador</th><th>Data da Compra</th></tr></thead><tbody>`;

            data.forEach(item => {
                resultHtml += `
                    <tr>
                        <td>${item.nomeProduto}</td>
                        <td>${item.quantidade}</td>
                        <td>${item.cpfComprador}</td>
                        <td>${new Date(item.dataCompra).toLocaleString()}</td>
                    </tr>
                `;
            });

            resultHtml += `</tbody></table>`;
            consultaResultDiv.innerHTML = resultHtml;
        })
        .catch(error => {
            console.error('Erro ao consultar compras:', error);
            consultaResultDiv.innerHTML = `<p style="color: red;">Erro: ${error.message}</p>`;
        });
    });
</script>
</body>
</html>
